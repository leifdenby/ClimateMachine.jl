<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>SurfaceFluxes · ClimateMachine</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../"><img src="../../../assets/logo.svg" alt="ClimateMachine logo"/></a><div class="docs-package-name"><span class="docs-autofit">ClimateMachine</span></div><form class="docs-search" action="../../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../">Home</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><label class="tocitem" for="menuitem-2"><span class="docs-label">Getting started</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../GettingStarted/Installation/">Installation</a></li><li><a class="tocitem" href="../../../GettingStarted/RunningClimateMachine/">Running</a></li><li><input class="collapse-toggle" id="menuitem-2-3" type="checkbox"/><label class="tocitem" for="menuitem-2-3"><span class="docs-label">Defaults</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../GettingStarted/Atmos/">Atmosphere model configurations</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1"><span class="docs-label">Atmos</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../generated/Atmos/heldsuarez/">Dry Idealized GCM</a></li><li><a class="tocitem" href="../../../generated/Atmos/burgers_single_stack/">Flow in Single Element Stack</a></li><li><a class="tocitem" href="../../../generated/Atmos/agnesi_hs_lin/">Linear Hydrostatic Mountain (Topography)</a></li><li><a class="tocitem" href="../../../generated/Atmos/agnesi_nh_lin/">Linear Non-Hydrostatic Mountain (Topography)</a></li></ul></li><li><span class="tocitem">Ocean</span></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Land</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-3-1"><span class="docs-label">Heat</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../generated/Land/Heat/heat_equation/">Heat Equation</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-4" type="checkbox"/><label class="tocitem" for="menuitem-3-4"><span class="docs-label">Numerics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-4-1" type="checkbox"/><label class="tocitem" for="menuitem-3-4-1"><span class="docs-label">System Solvers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../generated/Numerics/SystemSolvers/cg/">Conjugate Gradient</a></li><li><a class="tocitem" href="../../../generated/Numerics/SystemSolvers/bgmres/">Batched Generalized Minimal Residual</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-4-2" type="checkbox"/><label class="tocitem" for="menuitem-3-4-2"><span class="docs-label">DG Methods</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../generated/topo/">Topology</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-5" type="checkbox"/><label class="tocitem" for="menuitem-3-5"><span class="docs-label">Diagnostics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-5-1" type="checkbox"/><label class="tocitem" for="menuitem-3-5-1"><span class="docs-label">Debug</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../generated/Diagnostics/Debug/StateCheck/">State Statistics Regression</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-6" type="checkbox"/><label class="tocitem" for="menuitem-3-6"><span class="docs-label">Contributing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../generated/literate_markdown/">Notes on Literate</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">How-to-guides</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Common</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../HowToGuides/Common/Thermodynamics/">Thermodynamics</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Atmos</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../HowToGuides/Atmos/TemperatureProfiles/">TemperatureProfiles</a></li></ul></li><li><span class="tocitem">Ocean</span></li><li><span class="tocitem">Land</span></li><li><input class="collapse-toggle" id="menuitem-4-5" type="checkbox"/><label class="tocitem" for="menuitem-4-5"><span class="docs-label">Numerics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><span class="tocitem">Meshes</span></li><li><input class="collapse-toggle" id="menuitem-4-5-2" type="checkbox"/><label class="tocitem" for="menuitem-4-5-2"><span class="docs-label">DG methods</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../HowToGuides/Numerics/DGMethods/how_to_make_a_balance_law/">How to make a balance law</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-5-3" type="checkbox"/><label class="tocitem" for="menuitem-4-5-3"><span class="docs-label">ODE Solvers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../HowToGuides/Numerics/ODESolvers/Timestepping/">Time-integration</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-5-4" type="checkbox"/><label class="tocitem" for="menuitem-4-5-4"><span class="docs-label">System Solvers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../HowToGuides/Numerics/SystemSolvers/IterativeSolvers/">Iterative Solvers</a></li></ul></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">APIs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/">Home</a></li><li><a class="tocitem" href="../../../APIs/Driver/">Driver</a></li><li><input class="collapse-toggle" id="menuitem-5-3" type="checkbox"/><label class="tocitem" for="menuitem-5-3"><span class="docs-label">Atmos</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/Atmos/AtmosModel/">AtmosModel</a></li><li><a class="tocitem" href="../../../APIs/Atmos/Microphysics/">Microphysics</a></li><li><a class="tocitem" href="../../../APIs/Atmos/TemperatureProfiles/">Temperature Profiles</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-4" type="checkbox"/><label class="tocitem" for="menuitem-5-4"><span class="docs-label">Ocean</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/Ocean/HydrostaticBoussinesq/">Hydrostatic Boussinesq</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-5" type="checkbox"/><label class="tocitem" for="menuitem-5-5"><span class="docs-label">Land</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/Land/LandModel/">Land Model</a></li><li><a class="tocitem" href="../../../APIs/Land/SoilWaterParameterizations/">Soil Water Parameterizations</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-6" type="checkbox"/><label class="tocitem" for="menuitem-5-6"><span class="docs-label">Common</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/Common/Orientations/">Orientations</a></li><li><a class="tocitem" href="../../../APIs/Common/SurfaceFluxes/">Surface Fluxes</a></li><li><a class="tocitem" href="../../../APIs/Common/Thermodynamics/">Thermodynamics</a></li><li><a class="tocitem" href="../../../APIs/Common/TurbulenceClosures/">Turbulence Closures</a></li><li><a class="tocitem" href="../../../APIs/Common/TurbulenceConvection/">Turbulence Convection</a></li></ul></li><li><a class="tocitem" href="../../../APIs/BalanceLaws/BalanceLaws/">Balance Laws</a></li><li><a class="tocitem" href="../../../APIs/Arrays/Arrays/">Arrays</a></li><li><input class="collapse-toggle" id="menuitem-5-9" type="checkbox"/><label class="tocitem" for="menuitem-5-9"><span class="docs-label">Diagnostics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/Diagnostics/Diagnostics/">Diagnostics groups</a></li><li><a class="tocitem" href="../../../APIs/Diagnostics/StateCheck/">State Check</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-10" type="checkbox"/><label class="tocitem" for="menuitem-5-10"><span class="docs-label">Input/Output</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/InputOutput/">Input/Output</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-11" type="checkbox"/><label class="tocitem" for="menuitem-5-11"><span class="docs-label">Numerics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/Numerics/Meshes/Mesh/">Meshes</a></li><li><a class="tocitem" href="../../../APIs/Numerics/SystemSolvers/SystemSolvers/">SystemSolvers</a></li><li><a class="tocitem" href="../../../APIs/Numerics/ODESolvers/ODESolvers/">ODESolvers</a></li><li><a class="tocitem" href="../../../APIs/Numerics/DGMethods/DGMethods/">DG Methods</a></li><li><a class="tocitem" href="../../../APIs/Numerics/DGMethods/Courant/">Courant</a></li><li><a class="tocitem" href="../../../APIs/Numerics/DGMethods/NumericalFluxes/">Numerical Fluxes</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-12" type="checkbox"/><label class="tocitem" for="menuitem-5-12"><span class="docs-label">Utilities</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/Utilities/VariableTemplates/">Variable Templates</a></li><li><a class="tocitem" href="../../../APIs/Utilities/SingleStackUtils/">Single Stack Utilities</a></li><li><a class="tocitem" href="../../../APIs/Utilities/Checkpoint/">Checkpoint</a></li><li><a class="tocitem" href="../../../APIs/Utilities/TicToc/">Tic Toc</a></li></ul></li></ul></li><li><a class="tocitem" href="../../../Contributing/">Contribution guide</a></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox" checked/><label class="tocitem" for="menuitem-7"><span class="docs-label">Theory</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-7-1" type="checkbox" checked/><label class="tocitem" for="menuitem-7-1"><span class="docs-label">Common</span><i class="docs-chevron"></i></label><ul class="collapsed"><li class="is-active"><a class="tocitem" href>SurfaceFluxes</a><ul class="internal"><li><a class="tocitem" href="#Equations"><span>Equations</span></a></li><li><a class="tocitem" href="#Interface"><span>Interface</span></a></li><li><a class="tocitem" href="#Equations-2"><span>Equations</span></a></li><li><a class="tocitem" href="#Equations-3"><span>Equations</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li><li><a class="tocitem" href="../Turbulence/">Turbulence Closures</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-7-2" type="checkbox"/><label class="tocitem" for="menuitem-7-2"><span class="docs-label">Atmos</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Atmos/AtmosModel/">AtmosModel</a></li><li><a class="tocitem" href="../../Atmos/Microphysics/">Microphysics</a></li><li><a class="tocitem" href="../../Atmos/EDMFEquations/">EDMF equations</a></li><li><a class="tocitem" href="../../Atmos/Model/tracers/">Tracers</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-8" type="checkbox"/><label class="tocitem" for="menuitem-8"><span class="docs-label">Developer docs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../DevDocs/CodeStyle/">Coding style</a></li><li><a class="tocitem" href="../../../DevDocs/AcceptableUnicode/">Acceptable Unicode</a></li><li><a class="tocitem" href="../../../DevDocs/VariableList/">Variable list</a></li><li><a class="tocitem" href="../../../DevDocs/DiagnosticVariables/">Diagnostic variable list</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Theory</a></li><li><a class="is-disabled">Common</a></li><li class="is-active"><a href>SurfaceFluxes</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>SurfaceFluxes</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CliMA/ClimateMachine.jl/blob/master/docs/src/Theory/Common/SurfaceFluxes.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Surface-Fluxes"><a class="docs-heading-anchor" href="#Surface-Fluxes">Surface Fluxes</a><a id="Surface-Fluxes-1"></a><a class="docs-heading-anchor-permalink" href="#Surface-Fluxes" title="Permalink"></a></h1><p>This page contains a description of the SurfaceFluxes module, based on the Nishizawa surface-flux scheme.</p><blockquote><p>Nishizawa, S., &amp; Kitamura, Y. ( 2018). A surface flux scheme based on the Monin‐Obukhov similarity for finite volume models. <em>Journal of Advances in Modeling Earth Systems</em>, 10, 3159– 3175. <a href="https://doi.org/10.1029/2018MS001534">https://doi.org/10.1029/2018MS001534</a> &lt;em&gt;Internally abbreviated as NK&lt;/em&gt;    </p></blockquote><blockquote><p>Gryanik, V., Lupkes, C., Grachev, A. &amp; Sidorenko, D. (2020). New modified and extended stability functions for the stable boundary layer based on SHEBA and parametrizations of bulk transfer coefficients for climate models. <em>Journal of the Atmospheric Sciences</em>, 10.1175/JAS-D-19-0255.1. <a href="https://doi.org/10.1175/JAS-D-19-0255.1">https://doi.org/10.1175/JAS-D-19-0255.1</a>. (Early Online Release)  &lt;em&gt;Internally abbreviated as GLGS&lt;/em&gt;</p></blockquote><blockquote><p>Hill, R.J., 1989. Implications of Monin–Obukhov Similarity Theory for Scalar Quantities. <em>J. Atmos. Sci.,</em>  <strong>46</strong>, 2236–2244, <a href="https://doi.org/10.1175/1520-0469(1989)046%3C2236:IOMSTF%3E2.0.CO;2">https://doi.org/10.1175/1520-0469(1989)046&lt;2236:IOMSTF&gt;2.0.CO;2</a> </p></blockquote><h3 id="Parameters"><a class="docs-heading-anchor" href="#Parameters">Parameters</a><a id="Parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Parameters" title="Permalink"></a></h3><ul><li><div>\[L_{MO}\]</div>= Monin-Obukhov length</li><li><div>\[X_{\star}\]</div>= Scale parameter for variable <span>$X$</span></li><li><div>\[X_{sfc}\]</div>= Surface value of variable <span>$X$</span> </li><li><div>\[\kappa\]</div>= von-Karman coefficient (typically <span>$0.4$</span>)</li><li><div>\[\mathrm{D_T} = \nu/Pr_{T}\]</div>is the diffusivity</li><li><span>$Pr_{T}$</span> the neutral limit turbulent Prandtl number (typically <span>$\frac{1}{3}$</span>)</li><li><div>\[\nu\]</div>the kinematic viscosity</li><li><div>\[w\]</div>, the wall normal velocity component</li><li><div>\[\Delta z\]</div>= Model reference altitude</li><li><div>\[\delta_{\chi_{i}}\]</div>a measure of mixing efficiency for <span>$i$</span>th tracer </li><li><div>\[\zeta = z/L_{MO}\]</div>similarity variable</li><li><div>\[\nu/u_{\star}\]</div>Viscous lengthscale</li></ul><h3 id="Fluxes"><a class="docs-heading-anchor" href="#Fluxes">Fluxes</a><a id="Fluxes-1"></a><a class="docs-heading-anchor-permalink" href="#Fluxes" title="Permalink"></a></h3><ul><li>Momentum fluxes due to boundary shear</li></ul><div>\[-\rho \tau_{j3}|_{\mathrm{sfc}} = \rho \overline{w^{\prime}u_{j}^{\prime}}|_{\mathrm{sfc}} \]</div><p>where <span>$u$</span> represents the surface parallel velocity component, for <span>$j = 1,2$</span></p><ul><li>Sum of specific enthalpy and moist static energy flux</li></ul><div>\[\rho\mathrm{d}h_{t}|_{\mathrm{sfc}} = \rho \mathrm{(J+D)|_{sfc}} = -\rho D_{T}\nabla h_{t}|_{\mathrm{sfc}} = \rho[c_{pm}\overline{w^{\prime}\theta^{\prime}} + L_{v}\overline{w^{\prime}q_{t}^{\prime}}]|_{\mathrm{sfc}} \]</div><ul><li>Subgrid flux of total water specific humidity</li></ul><div>\[\rho\mathrm{d}q_{t}|_{\mathrm{sfc}}  = -\rho D_{T}\nabla q_{t}|_{\mathrm{sfc}}  = \rho L_{v} \overline{w^{\prime}q_{t}^{\prime}}|_{\mathrm{sfc}} \]</div><ul><li>Subgrid flux of tracer <span>$i$</span>, for <span>$i = 1..n$</span> tracers, n an integer</li></ul><div>\[\rho\mathrm{d}\chi_{i}|_{\mathrm{sfc}}  = -\rho \delta_{\chi_{i}} D_{T}\nabla \chi_{i}|_{\mathrm{sfc}}  = \rho \overline{w^{\prime}\chi_{i}^{\prime}}|_{\mathrm{sfc}} \]</div><p>We also have, by assumption that each variable can be represented in terms of the universal functions <span>$\Phi_{k}$</span> for the <span>$k$</span>th variable,</p><ul><li><div>\[\overline{w^{\prime}u^{\prime}}|_{\mathrm{sfc}} = -u_{\star}^2\]</div></li><li><div>\[\overline{w^{\prime}\theta^{\prime}}|_{\mathrm{sfc}} = -u_{\star}\theta_{\star} = \frac{J}{\rho c_{pm}}\]</div></li><li><div>\[\overline{w^{\prime}q_{t}^{\prime}}|_{\mathrm{sfc}} = -u_{\star}q_{t\star} = \frac{D}{\rho L_{v}}\]</div></li><li><div>\[\overline{w^{\prime}\chi_{i}^{\prime}}|_{\mathrm{sfc}} = -u_{\star}\chi_{i\star}\]</div></li></ul><h3 id="Boundary-conditions"><a class="docs-heading-anchor" href="#Boundary-conditions">Boundary conditions</a><a id="Boundary-conditions-1"></a><a class="docs-heading-anchor-permalink" href="#Boundary-conditions" title="Permalink"></a></h3><p>Required variables for boundary condition prescription in <code>ClimateMachine</code> are</p><h4 id="Momentum"><a class="docs-heading-anchor" href="#Momentum">Momentum</a><a id="Momentum-1"></a><a class="docs-heading-anchor-permalink" href="#Momentum" title="Permalink"></a></h4><div>\[u_{\star}\]</div><p>in <code>bc_momentum.jl</code> . Usage is through the <code>DragLaw</code> function. Current use cases include prescribed values for <span>$u_{\star}$</span>, or prescribed exchange coefficients.</p><h4 id="Energy"><a class="docs-heading-anchor" href="#Energy">Energy</a><a id="Energy-1"></a><a class="docs-heading-anchor-permalink" href="#Energy" title="Permalink"></a></h4><div>\[\hat{n} \cdot \mathrm{d}h_{tot}\]</div><p>in <code>bc_energy.jl</code> . Usage currently is through the <code>PrescribedEnergyFlux</code></p><h4 id="Moisture"><a class="docs-heading-anchor" href="#Moisture">Moisture</a><a id="Moisture-1"></a><a class="docs-heading-anchor-permalink" href="#Moisture" title="Permalink"></a></h4><div>\[\hat{n} \cdot \mathrm{d}q_{tot}\]</div><p>in <code>bc_moisture.jl</code>  . Usage currently is through <code>PrescribedMoistureFlux</code></p><h4 id="Tracer-Flux"><a class="docs-heading-anchor" href="#Tracer-Flux">Tracer Flux</a><a id="Tracer-Flux-1"></a><a class="docs-heading-anchor-permalink" href="#Tracer-Flux" title="Permalink"></a></h4><div>\[\hat{n} \cdot \mathrm{d}\chi_{i}\]</div><p>in <code>bc_moisture.jl</code>  . No use cases currently. Tracers do not permeate through boundaries in present implementation. </p><p>In each of these cases <span>$\hat{n}$</span> corresponds to the upward pointing unit-normal vector. </p><h2 id="Equations"><a class="docs-heading-anchor" href="#Equations">Equations</a><a id="Equations-1"></a><a class="docs-heading-anchor-permalink" href="#Equations" title="Permalink"></a></h2><p>We start by defining the universal functions for the velocity, enthalpy and moisture terms. <em>NK</em> express the Monin-Obukhov length in terms of the potential temperature </p><div>\[L_{MO} = -\frac{u_{\star}^3 \overline{\theta}}{\kappa g \overline{w^{\prime}\theta^{\prime}}|_{sfc}} \]</div><p>From the above definitions for the fluxes in the moist, compressible flow equations, we substitute the potential temperature flux <span>$\overline{w^{\prime}\theta^{\prime}} = J/(\rho c_{pm})$</span>, <span>$\overline{w^{\prime}u^{\prime}} = \tau/\rho)$</span> to recover eq (1) in <em>GLGS</em>. </p><div>\[L_{MO} = -\frac{(\tau/\rho)^{(3/2)} \overline{\theta}}{\kappa g \frac{J}{(\rho c_{pm})}|_{sfc}} \]</div><p>Given the formulation of the compressible flow equations in <code>ClimateMachine</code>  we arrive at the following formulation for the Monin-Obukhov similarity length</p><div>\[L_{MO} = - \frac{\overline{\theta} u_{\star}^3}{\kappa g [\overline{w^{\prime}\theta^{\prime}} + \overline{w^{\prime}q_{t}^{\prime}}]} = - \frac{\overline{\theta} u_{\star}^3}{\kappa g [\frac{J}{\rho c_{pm}} + \frac{D}{\rho L_{v}}]}\]</div><p>NK use volume-averaged quantities<span>$\langle X \rangle$</span> such that </p><div>\[\langle X \rangle = \frac{1}{\Delta z} \int_{0}^{\Delta z} X(z) dz\]</div><p>In the <code>ClimateMachine</code> DG discretization we interpret these as the nodal variable values at a given model reference altitude <span>$\Delta z$</span>. This value is currently taken as the first interior grid point in the model column description, which typically is of <span>$O(1-10)$</span> in LES configurations and <span>$O(10-100)$</span> in the GCM configurations. An alternative to this is obtained by fixing the reference <span>$\Delta z$</span> and interpolating the DG polynomials to determine variable values at the specified model height. Applying <em>NK</em> equations (17), (18) to the <code>ClimateMachine</code> equations we arrive at </p><div>\[u_{\star} = \frac{\kappa (\langle u  \rangle - u_{sfc})}{\log(\frac{z}{z_{0m}})-\Psi_{h}(\frac{\Delta z}{L_{MO}}) + (\frac{z_{0m}}{\Delta z})\Psi_{m}(\frac{\Delta z_{0m}}{L_{MO}}) +  (1 − \frac{z_{0m}}{Δz})\{ \Psi_{m} (\frac{z_{0m}}{L_{MO}}) - 1\} } \]</div><div>\[h_{\star} = \frac{\frac{\kappa}{Pr_{T}}(\langle h_{tot} \rangle- h_{sfc})  }{\log(\frac{z}{z_{0h}})-\Psi_{h}(\frac{\Delta z}{L_{MO}}) + (\frac{z_{0h}}{\Delta z})\Psi_{h}(\frac{\Delta z_{0h}}{L_{MO}}) + (1 − \frac{z_{0h}}{Δz})\{ \Psi_{h} (\frac{z_{0h}}{L_{MO}}) - 1\}} \]</div><div>\[q_{\star} = \frac{\frac{\kappa}{Pr_{T}} (\langle q \rangle- q_{sfc})  }{\log(\frac{z}{z_{0q}})-\Psi_{q}(\frac{\Delta z}{L_{MO}}) + (\frac{z_{0q}}{\Delta z})\Psi_{q}(\frac{\Delta z_{0q}}{L_{MO}}) +  (1 − \frac{z_{0q}}{Δz})\{ \Psi_{q} (\frac{z_{0q}}{L_{MO}}) - 1\}    } \]</div><p>Here we follow Hill&#39;s (1989) argument for the form of the universal functions for tracers which are assumed to follow the Monin-Obukhov similarity theory. </p><p>The three equations above combined with the M-O similarity length provide 4 equations for 4 unknowns. Once the Monin-Obukhov length is computed, we can then obtain the tracer surface values. </p><div>\[\chi_{i\star} = \frac{\frac{\kappa}{Pr_{T} \delta \chi_{i}} (\langle \chi_{i} \rangle- \chi_{i,sfc})  }{\log(\frac{z}{z_{0h}})-\Psi_{\chi_{i}}(\frac{\Delta z}{L_{MO}}) + (\frac{z_{0\chi_{i}}}{\Delta z})\Psi_{\chi_{i}}(\frac{\Delta z_{0\chi_{i}}}{L_{MO}}) +  (1 − \frac{z_{0h}}{Δz})\{ \Psi_{\chi_{i}} (\frac{z_{0h}}{L_{MO}}) - 1\} } \]</div><h4 id="Additional-equations"><a class="docs-heading-anchor" href="#Additional-equations">Additional equations</a><a id="Additional-equations-1"></a><a class="docs-heading-anchor-permalink" href="#Additional-equations" title="Permalink"></a></h4><ul><li><div>\[\frac{\kappa z}{u_{\star}}\frac{\partial u}{\partial z} = \Phi_{m}\]</div></li><li><div>\[\frac{\kappa z}{h_{\star}}\frac{\partial h_{tot}}{\partial z} = \Phi_{h}\]</div></li><li><div>\[\frac{\kappa z}{q_{\star}}\frac{\partial q_{tot}}{\partial z} = \Phi_{q}\]</div></li><li><div>\[\frac{\kappa z}{\chi_{i\star}}\frac{\partial \chi_{i}}{\partial z} = \Phi_{\chi}\]</div></li></ul><p>This module provides a means to compute surface fluxes given several variables, described in <a href="../../../APIs/Common/SurfaceFluxes/#ClimateMachine.SurfaceFluxes.surface_conditions"><code>surface_conditions</code></a>.</p><h2 id="Interface"><a class="docs-heading-anchor" href="#Interface">Interface</a><a id="Interface-1"></a><a class="docs-heading-anchor-permalink" href="#Interface" title="Permalink"></a></h2><ul><li><a href="../../../APIs/Common/SurfaceFluxes/#ClimateMachine.SurfaceFluxes.surface_conditions"><code>surface_conditions</code></a> computes<ul><li>Monin-Obukhov length</li><li>Potential temperature flux (if not given) using Monin-Obukhov theory</li><li>transport fluxes using Monin-Obukhov theory</li><li>friction velocity/temperature scale/tracer scales</li><li>exchange coefficients</li></ul></li></ul><h2 id="Equations-2"><a class="docs-heading-anchor" href="#Equations-2">Equations</a><a class="docs-heading-anchor-permalink" href="#Equations-2" title="Permalink"></a></h2><p>This page contains an extension of the Nishizawa surface-flux scheme for use within the ClimateMachine framework. </p><blockquote><p>Nishizawa, S., &amp; Kitamura, Y. ( 2018). A surface flux scheme based on the Monin‐Obukhov similarity for finite volume models. <em>Journal of Advances in Modeling Earth Systems</em>, 10, 3159– 3175. <a href="https://doi.org/10.1029/2018MS001534">https://doi.org/10.1029/2018MS001534</a> &lt;em&gt;Internally abbreviated as NK&lt;/em&gt;	</p></blockquote><blockquote><p>Gryanik, V., Lupkes, C., Grachev, A. &amp; Sidorenko, D. (2020). New modified and extended stability functions for the stable boundary layer based on SHEBA and parametrizations of bulk transfer coefficients for climate models. <em>Journal of the Atmospheric Sciences</em>, 10.1175/JAS-D-19-0255.1. <a href="https://doi.org/10.1175/JAS-D-19-0255.1">https://doi.org/10.1175/JAS-D-19-0255.1</a>. (Early Online Release)  <em>Internally abbreviated as GLGS</em></p></blockquote><blockquote><p>Hill, R.J., 1989. Implications of Monin–Obukhov Similarity Theory for Scalar Quantities. <em>J. Atmos. Sci.,</em>  <strong>46</strong>, 2236–2244, <a href="https://doi.org/10.1175/1520-0469(1989)046%3C2236:IOMSTF%3E2.0.CO;2">https://doi.org/10.1175/1520-0469(1989)046&lt;2236:IOMSTF&gt;2.0.CO;2</a> </p></blockquote><h3 id="Parameters-2"><a class="docs-heading-anchor" href="#Parameters-2">Parameters</a><a class="docs-heading-anchor-permalink" href="#Parameters-2" title="Permalink"></a></h3><ul><li><div>\[L_{MO}\]</div>= Monin-Obukhov length</li><li><div>\[X__{\star}\]</div>= Scale parameter for variable <span>$X$</span></li><li><div>\[X__{sfc}\]</div>= Surface value of variable <span>$X$</span> </li><li><div>\[\kappa\]</div>= von-Karman coefficient (typically <span>$0.4$</span>)</li><li><div>\[\mathrm{D_T} = \nu/Pr_{T}\]</div>is the diffusivity</li><li><span>$Pr__{T}$</span> the neutral limit turbulent Prandtl number (typically <span>$\frac{1}{3}$</span>)</li><li><div>\[\nu\]</div>the kinematic viscosity</li><li><div>\[w\]</div>, the wall normal velocity component</li><li><div>\[\Delta z\]</div>= Model reference altitude</li><li><div>\[\delta__{\chi_{i}}\]</div>a measure of mixing efficiency for <span>$i$</span>th tracer </li><li><div>\[\zeta = z/L_{MO}\]</div>similarity variable</li><li><div>\[\nu/u__{\star}\]</div>Viscous lengthscale</li></ul><h3 id="Fluxes-2"><a class="docs-heading-anchor" href="#Fluxes-2">Fluxes</a><a class="docs-heading-anchor-permalink" href="#Fluxes-2" title="Permalink"></a></h3><ul><li>Momentum fluxes due to boundary shear</li></ul><div>\[-\rho \tau_{j3}|_{\mathrm{sfc}} = \rho \overline{w^{\prime}u_{j}^{\prime}}|_{\mathrm{sfc}} \]</div><p>where <span>$u$</span> represents the surface parallel velocity component, for <span>$j = 1,2$</span></p><ul><li>Sum of specific enthalpy and moist static energy flux</li></ul><div>\[\rho\mathrm{d}h_{t}|_{\mathrm{sfc}} = \rho \mathrm{(J+D)|_{sfc}} = -\rho D_{T}\nabla h_{t}|_{\mathrm{sfc}} = \rho[c_{pm}\overline{w^{\prime}\theta^{\prime}} + L_{v}\overline{w^{\prime}q_{t}^{\prime}}]|_{\mathrm{sfc}} \]</div><ul><li>Subgrid flux of total water specific humidity</li></ul><div>\[\rho\mathrm{d}q_{t}|_{\mathrm{sfc}}  = -\rho D_{T}\nabla q_{t}|_{\mathrm{sfc}}  = \rho L_{v} \overline{w^{\prime}q_{t}^{\prime}}|_{\mathrm{sfc}}\]</div><ul><li>Subgrid flux of tracer <span>$i$</span>, for <span>$i = 1..n$</span> tracers, n an integer</li></ul><div>\[\rho\mathrm{d}\chi_{i}|_{\mathrm{sfc}}  = -\rho \delta_{\chi_{i}} D_{T}\nabla \chi_{i}|_{\mathrm{sfc}}  = \rho \overline{w^{\prime}\chi_{i}^{\prime}}|_{\mathrm{sfc}}\]</div><p>We also have, by assumption that each variable can be represented in terms of the universal functions <span>$\Phi_{k}$</span> for the <span>$k$</span>th variable,</p><ul><li><div>\[\overline{w^{\prime}u^{\prime}}|_{\mathrm{sfc}} = -u_{\star}^2\]</div></li><li><div>\[\overline{w^{\prime}\theta^{\prime}}|_{\mathrm{sfc}} = -u_{\star}\theta_{\star} = \frac{J}{\rho c_{pm}}\]</div></li><li><div>\[\overline{w^{\prime}q_{t}^{\prime}}|_{\mathrm{sfc}} = -u_{\star}q_{t\star} = \frac{D}{\rho L_{v}}\]</div></li><li><div>\[\overline{w^{\prime}\chi_{i}^{\prime}}|_{\mathrm{sfc}} = -u_{\star}\chi_{i\star}\]</div></li></ul><h3 id="Boundary-conditions-2"><a class="docs-heading-anchor" href="#Boundary-conditions-2">Boundary conditions</a><a class="docs-heading-anchor-permalink" href="#Boundary-conditions-2" title="Permalink"></a></h3><p>Required variables for boundary condition prescription in <code>ClimateMachine</code> are</p><h4 id="Momentum-2"><a class="docs-heading-anchor" href="#Momentum-2">Momentum</a><a class="docs-heading-anchor-permalink" href="#Momentum-2" title="Permalink"></a></h4><div>\[u_{\star}\]</div><p>in <code>bc_momentum.jl</code> . Usage is through the <code>DragLaw</code> function. Current use cases include prescribed values for <span>$u_{\star}$</span>, or prescribed exchange coefficients.</p><h4 id="Energy-2"><a class="docs-heading-anchor" href="#Energy-2">Energy</a><a class="docs-heading-anchor-permalink" href="#Energy-2" title="Permalink"></a></h4><div>\[\hat{n} \cdot \mathrm{d}h_{tot}\]</div><p>in <code>bc_energy.jl</code> . Usage currently is through the <code>PrescribedEnergyFlux</code></p><h4 id="Moisture-2"><a class="docs-heading-anchor" href="#Moisture-2">Moisture</a><a class="docs-heading-anchor-permalink" href="#Moisture-2" title="Permalink"></a></h4><div>\[\hat{n} \cdot \mathrm{d}q_{tot}\]</div><p>in <code>bc_moisture.jl</code>  . Usage currently is through <code>PrescribedMoistureFlux</code></p><h4 id="Tracer-Flux-2"><a class="docs-heading-anchor" href="#Tracer-Flux-2">Tracer Flux</a><a class="docs-heading-anchor-permalink" href="#Tracer-Flux-2" title="Permalink"></a></h4><div>\[\hat{n} \cdot \mathrm{d}\chi_{i}\]</div><p>in <code>bc_moisture.jl</code>  . No use cases currently. Tracers do not permeate through boundaries in present implementation. </p><p><code>FixedExchangeCoefficients</code> <code>DynamicExchangeCoefficients</code> <code>InteractiveSurfaceFluxes</code></p><p>In each of these cases <span>$\hat{n}$</span> corresponds to the upward pointing unit-normal vector. </p><h2 id="Equations-3"><a class="docs-heading-anchor" href="#Equations-3">Equations</a><a class="docs-heading-anchor-permalink" href="#Equations-3" title="Permalink"></a></h2><p>We start by defining the universal functions for the velocity, enthalpy and moisture terms. <em>NK</em> express the Monin-Obukhov length in terms of the potential temperature </p><div>\[L_{MO} = -\frac{u_{\star}^3 \overline{\theta}}{\kappa g \overline{w^{\prime}\theta^{\prime}}|_{sfc}} \]</div><p>From the above definitions for the fluxes in the moist, compressible flow equations, we substitute the potential temperature flux <span>$\overline{w^{\prime}\theta^{\prime}} = J/(\rho c_{p})$</span>, <span>$\overline{w^{\prime}u^{\prime}} = \tau/\rho)$</span> to recover eq (1) in <em>GLGS</em>. </p><div>\[L_{MO} = -\frac{(\tau/\rho)^{(3/2)} \overline{\theta}}{\kappa g \frac{J}{(\rho c_{p})}|_{sfc}} \]</div><p>Given the formulation of the compressible flow equations in <code>ClimateMachine</code>  we arrive at the following formulation for the Monin-Obukhov similarity length</p><div>\[L_{MO} = - \frac{\overline{\theta_v} u_{\star}^3}{\kappa g [\overline{\theta_v^{\prime}{w^{\prime}}}]}\]</div><p>NK use volume-averaged quantities<span>$\langle X \rangle$</span> such that </p><div>\[\langle X \rangle = \frac{1}{\Delta z} \int_{0}^{\Delta z} X(z) dz\]</div><p>In the <code>ClimateMachine</code> DG discretization we interpret these as the nodal variable values at a given model reference altitude <span>$\Delta z$</span>. This value is currently taken as the first interior grid point in the model column description, which typically is of <span>$O(1-10)$</span> in LES configurations and <span>$O(10-100)$</span> in the GCM configurations. An alternative to this is obtained by fixing the reference <span>$\Delta z$</span> and interpolating the DG polynomials to determine variable values at the specified model height. Applying <em>NK</em> equations (17), (18) to the <code>ClimateMachine</code> equations we arrive at </p><div>\[u_{\star} = \frac{\kappa (\langle u  \rangle - u_{sfc})}{\log(\frac{z}{z_{0m}})-\Psi_{h}(\frac{\Delta z}{L_{MO}}) + (\frac{z_{0m}}{\Delta z})\Psi_{m}(\frac{\Delta z_{0m}}{L_{MO}}) +  (1 − \frac{z_{0m}}{Δz})\{ \Psi_{m} (\frac{z_{0m}}{L_{MO}}) - 1\} } \]</div><div>\[\theta_{v\star} = \frac{\frac{\kappa}{Pr_{T}}(\langle \theta_{v} \rangle- \theta_{v,sfc})  }{\log(\frac{z}{z_{0h}})-\Psi_{h}(\frac{\Delta z}{L_{MO}}) + (\frac{z_{0h}}{\Delta z})\Psi_{h}(\frac{\Delta z_{0h}}{L_{MO}}) + (1 − \frac{z_{0h}}{Δz})\{ \Psi_{h} (\frac{z_{0h}}{L_{MO}}) - 1\}} \]</div><p>Alternatively, use a new thermal scale parameter (according to the prognostic equations)</p><div>\[h_{\star} = \frac{\frac{\kappa}{Pr_{T}}(\langle h_{tot} \rangle- h_{sfc})  }{\log(\frac{z}{z_{0h}})-\Psi_{h}(\frac{\Delta z}{L_{MO}}) + (\frac{z_{0h}}{\Delta z})\Psi_{h}(\frac{\Delta z_{0h}}{L_{MO}}) + (1 − \frac{z_{0h}}{Δz})\{ \Psi_{h} (\frac{z_{0h}}{L_{MO}}) - 1\}} \]</div><div>\[q_{\star} = \frac{\frac{\kappa}{Pr_{T}} (\langle q \rangle- q_{sfc})  }{\log(\frac{z}{z_{0q}})-\Psi_{q}(\frac{\Delta z}{L_{MO}}) + (\frac{z_{0q}}{\Delta z})\Psi_{q}(\frac{\Delta z_{0q}}{L_{MO}}) +  (1 − \frac{z_{0q}}{Δz})\{ \Psi_{q} (\frac{z_{0q}}{L_{MO}}) - 1\}    } \]</div><p>Here we follow Hill&#39;s (1989) argument for the form of the universal functions for tracers which are assumed to follow the Monin-Obukhov similarity theory. </p><p>The equations above combined with the M-O similarity length provide 4 equations for 4 unknowns. Once the Monin-Obukhov length is computed, we can then obtain the tracer surface values. </p><div>\[\chi_{i\star} = \frac{\frac{\kappa  \delta \chi_{i}}{Pr_{T}} (\langle \chi_{i} \rangle- \chi_{i,sfc})  }{\log(\frac{z}{z_{0h}})-\Psi_{\chi_{i}}(\frac{\Delta z}{L_{MO}}) + (\frac{z_{0\chi_{i}}}{\Delta z})\Psi_{\chi_{i}}(\frac{\Delta z_{0\chi_{i}}}{L_{MO}}) +  (1 − \frac{z_{0h}}{Δz})\{ \Psi_{\chi_{i}} (\frac{z_{0h}}{L_{MO}}) - 1\} } \]</div><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><ul><li><p>Businger, Joost A., et al. &quot;Flux-profile relationships in the atmospheric surface layer.&quot; Journal of the atmospheric Sciences 28.2 (1971): 181-189.</p></li><li><p>Nishizawa, S., and Y. Kitamura. &quot;A Surface Flux Scheme Based on the Monin-Obukhov Similarity for Finite Volume Models.&quot; Journal of Advances in Modeling Earth Systems 10.12 (2018): 3159-3175.</p></li><li><p>Businger, Joost A., et al. &quot;Flux-profile relationships in the atmospheric surface layer.&quot; Journal of the atmospheric Sciences 28.2 (1971): 181-189. doi: <a href="https://doi.org/10.1175/1520-0469(1971)028&lt;0181:FPRITA&gt;2.0.CO;2">10.1175/1520-0469(1971)028&lt;0181:FPRITA&gt;2.0.CO;2</a></p></li><li><p>Byun, Daewon W. &quot;On the analytical solutions of flux-profile relationships for the atmospheric surface layer.&quot; Journal of Applied Meteorology 29.7 (1990): 652-657.</p></li><li><p>Wyngaard, John C. &quot;Modeling the planetary boundary layer-Extension to the stable case.&quot; Boundary-Layer Meteorology 9.4 (1975): 441-460.</p></li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../../Contributing/">« Contribution guide</a><a class="docs-footer-nextpage" href="../Turbulence/">Turbulence Closures »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 7 July 2020 16:22">Tuesday 7 July 2020</span>. Using Julia version 1.4.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
